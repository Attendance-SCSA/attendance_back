<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scsa.attend.mapper.UserMapper">

    <select id="selectAllMembers" resultType="User">
        SELECT
            ID,
            LOGIN_ID,
            LOGIN_PWD,
            NAME,
            COMPANY,
            ROLE,
            START_DAY,
            END_DAY
        FROM
            USERS
        WHERE
            ROLE = 'member'
        ORDER BY
            ID ASC
    </select>

    <insert id="insertMember" parameterType="User">

        INSERT INTO USERS (
            LOGIN_ID,
            LOGIN_PWD,
            NAME,
            COMPANY,
            ROLE,
            START_DAY,
            END_DAY
            )
        VALUES (
            #{loginId},
            #{loginPwd},
            #{name},
            #{company},
            #{role},
            #{startDay},
            #{endDay}
        )

        <selectKey keyProperty="id" resultType="int" order="AFTER">
            SELECT users_seq.CURRVAL FROM DUAL
        </selectKey>

    </insert>

    <select id="selectMember" parameterType="int" resultType="User">
        SELECT
            ID,
            LOGIN_ID,
            LOGIN_PWD,
            NAME,
            COMPANY,
            ROLE,
            START_DAY,
            END_DAY
        FROM
            USERS
        WHERE
            ID = #{memberId}
            AND ROLE = 'member'
    </select>

    <select id="selectUserByLoginIdAndLoginPwd" resultType="User">
        SELECT
        ID,
        LOGIN_ID,
        LOGIN_PWD,
        NAME,
        COMPANY,
        ROLE,
        START_DAY,
        END_DAY
        FROM
        USERS
        WHERE
            LOGIN_ID = #{loginId}
            AND LOGIN_PWD = #{loginPwd}
    </select>

    <update id="updateUser" parameterType="User">
        UPDATE USERS
        SET
            LOGIN_PWD = #{loginPwd},
            NAME = #{name},
            COMPANY = #{company}
        WHERE
            ID = #{id}
    </update>

    <delete id="deleteUser" parameterType="int">
        DELETE FROM
        USERS
        WHERE
        ID = #{memberId}
    </delete>


    <!-- 내부 검증 로직 -->

    <select id="selectUser" resultType="User">
        SELECT
            ID,
            LOGIN_ID,
            LOGIN_PWD,
            NAME,
            COMPANY,
            ROLE,
            START_DAY,
            END_DAY
        FROM
            USERS
        WHERE
            ID = #{userId}
    </select>

    <select id="selectUserByLoginId" resultType="User">
        SELECT
            ID,
            LOGIN_ID,
            LOGIN_PWD,
            NAME,
            COMPANY,
            ROLE,
            START_DAY,
            END_DAY
        FROM
            USERS
        WHERE
            LOGIN_ID = #{loginId}
    </select>

</mapper>